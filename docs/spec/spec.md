# 소규모 대면 서비스 예약 관리 시스템 — 기능명세서

> 최종 수정일: 2026-02-12
> 버전: v2.1

---

## 1. 시스템 개요

| 항목 | 내용 |
|------|------|
| 시스템명 | 소규모 대면 서비스 예약 관리 시스템 |
| 목적 | 예약 신청 → 입금 확인 → 확정 → 알림 자동 발송까지 하나의 웹 시스템으로 통합 관리 |
| 특징 | **관리자 설정만으로 브랜딩 변경** — 코드 수정 없이 스토어명·예약 문구·입금 계좌·알림 발신자명 등을 설정 페이지에서 변경 |
| 사용자 유형 | 예약자(Google 로그인 사용자), 관리자(운영자) |
| 기술 스택 | Next.js 16 (App Router), React 19, TypeScript, Tailwind CSS v4, Supabase (Auth + DB + Realtime), Google Calendar API, Google Sheets API, 카카오 알림톡(알리고), Vercel |

### 적합 업종

| 업종 | 예시 |
|------|------|
| 공방/클래스 | 도예, 가죽, 비즈, 플라워, 향수, 베이킹 |
| 1인 전문 서비스 | 네일아트, 속눈썹, 타투, 개인 PT |
| 소규모 스튜디오 | 사진관, 댄스, 요가, 필라테스 |
| 상담/컨설팅 | 법률, 세무, 심리 상담 |
| 체험/투어 | 농장 체험, 공예 투어, 원데이 프로그램 |

---

## 2. 예약 상태 흐름 (Reservation State Flow)

```
[예약 신청] ──→ pending (입금 대기)
       │              │
       ▼              │
 /booking/complete    │
 (예약 완료 안내 +     │
  입금 정보 표시)      │
                ┌─────┴─────┐
                ▼           ▼
           confirmed     rejected
         (확정(입금 완료))  (반려·안내)
                │
                ├──→ 사용자 취소 요청 (cancel_reason 저장)
                │       │
                │   ┌───┴───┐
                │   ▼       ▼
                │  취소 승인  취소 반려 → confirmed 유지
                │   │       (reject_reason에 반려 사유 저장,
                │   │        cancel_reason 클리어,
                │   │        사용자 재요청 가능)
                │   ▼
                └─→ cancelled (취소)
                    └─→ 대기 중 변경 요청 자동 거절
```

### 상태 정의

| 상태 | 코드 | 설명 | 트리거 | 사용자 화면 |
|------|------|------|--------|-------------|
| 입금 대기 | `pending` | 예약자가 폼을 통해 신청 완료, 입금 대기 상태 | 예약 폼 제출 | `/booking/complete` (예약 완료 안내 + 입금 정보) |
| 확정(입금 완료) | `confirmed` | 입금 확인 완료, Calendar·Sheets 연동 | 관리자 입금 확인 버튼 | 마이페이지에서 상태 확인 |
| 반려 | `rejected` | 예약 불가, 문의 안내 발송 (알림톡 활성 시) | 관리자 반려 버튼 | 마이페이지에서 반려 사유 확인 |
| 취소 | `cancelled` | 확정 후 취소 (사용자 요청 → 관리자 승인) | 관리자 취소 승인 | 마이페이지에서 상태 확인 |

### 취소 요청 세부 흐름

| 현재 상태 | 사용자 액션 | 처리 방식 | 결과 |
|-----------|-----------|-----------|------|
| `pending` | 취소 요청 | 즉시 취소 (관리자 승인 불요) | → `cancelled` |
| `confirmed` | 취소 요청 | `cancel_reason` 저장, 관리자 승인 대기 | 마이페이지에 "취소 요청 중" 표시 |
| `confirmed` + 취소 요청 | 관리자 **취소 승인** | → `cancelled` + Calendar 삭제 + Sheets 상태 업데이트 + 대기 중 변경 요청 자동 거절 + 취소 알림 발송 | 마이페이지에 "취소" 표시 |
| `confirmed` + 취소 요청 | 관리자 **취소 반려** | `cancel_reason` 클리어 + `reject_reason`에 반려 사유 저장 | 마이페이지에 "취소 반려됨" + 반려 사유 표시, 재요청 가능 |

---

## 3. 사용자 인증

### 3-1. Google 로그인 (`/login`)

| 항목 | 내용 |
|------|------|
| 인증 방식 | Supabase Auth — Google OAuth 2.0 |
| 로그인 UI | "Google 계정으로 로그인" 버튼 (간결한 원클릭 방식) |
| 로그인 후 이동 | 최초 로그인 → 예약 페이지, 이후 → 예약 페이지 |
| 비로그인 접근 | 예약 페이지 접근 시 로그인 페이지로 리다이렉트 (returnTo 파라미터) |

### 3-2. 프로필 관리

| 항목 | 내용 |
|------|------|
| 저장 시점 | 최초 예약 시 이름/연락처/입금자명을 프로필에 저장 |
| 자동완성 | 이후 예약 시 프로필 정보로 자동 채움 (수정 가능) |
| 프로필 수정 | 마이페이지에서 이름/연락처/입금자명 변경 가능 |

---

## 4. 사용자 예약 페이지

### 4-1. 예약 신청 폼 (`/booking`)

**접근 조건**: Google 로그인 필수. 미로그인 시 `/login`으로 리다이렉트.

**페이지 제목**: 관리자 설정의 `booking_page_title` 값 (기본: "예약")

#### 4단계 입력 흐름

| 단계 | 이름 | 입력 항목 | 설명 |
|------|------|----------|------|
| Step 1 | 수업 | 수업 종류 (드롭다운) | 활성화된 수업 목록에서 선택. 선택 시 소요 시간·가격·정원 정보 표시. 안내 문구는 `booking_step1_label` 설정값 사용 |
| Step 2 | 일시 | 희망 날짜 (달력) + 시간 (버튼 그리드) + 인원 | 관리자가 등록한 날짜만 활성화. 날짜의 시간 슬롯에서 잔여석 확인 후 선택. 인원수 입력 (1~정원) |
| Step 3 | 정보 | 이름 / 연락처 / 입금자명 / 요청사항 | 프로필에 저장된 값 자동완성. 전화번호 010-XXXX-XXXX 자동 포맷. 요청사항(선택) |
| Step 4 | 확인 | 전체 확인 후 제출 | 입력 내용 요약 → "예약 신청하기" 버튼 |

#### Step 2 날짜/시간/인원 선택 로직

1. 수업 선택 → 해당 수업에 등록된 스케줄(날짜)만 달력에 활성화
2. 날짜 선택 → 해당 날짜의 시간 슬롯 목록 표시
3. 각 시간 슬롯에 잔여석 표시 (예: "14:00 (2/4석)")
4. 정원 초과 슬롯은 "마감" 표시 후 선택 불가
5. 인원수 선택: 1명 ~ 잔여석까지 (기본값: 1명)
6. 실시간 잔여석 업데이트 (Supabase Realtime broadcast)

#### 제출 후 동작

- 예약 정보 DB 저장 + 프로필 정보 자동 저장(최초 예약 시)
- 정원 초과 체크 (`check_schedule_capacity` 함수 — 인원수 포함)
- **예약 신청 완료 페이지(`/booking/complete`)로 자동 이동**
- 예약 내용(수업, 날짜, 시간, 소요시간, 가격, 인원, 예약자, 연락처, 입금자명)을 쿼리 파라미터로 전달
- Realtime broadcast로 다른 예약자에게 잔여석 변경 알림

### 4-1-1. 예약 신청 완료 페이지 (`/booking/complete`)

**접근 방식**: 예약 신청 완료 시 자동 리다이렉트 (쿼리 파라미터로 예약 정보 수신)

#### 표시 내용

| 영역 | 항목 | 설명 |
|------|------|------|
| 완료 안내 | 체크 아이콘 + 타이틀 | "예약 신청이 완료되었습니다" + 입금 안내 문구 |
| 입금 안내 | 은행, 계좌번호, 예금주 | `/api/settings/public`에서 조회 |
| | 입금 금액 | 수업 가격 × 인원수 (다인 예약 시 수식 표시) |
| | 입금 기한 | 신청 후 N시간 이내 안내 |
| 예약 내용 확인 | 수업, 날짜, 시간, 소요시간 | 예약한 수업 정보 요약 |
| | 인원 | 2명 이상일 때 표시 |
| | 가격 | 총 금액 (다인 예약 시 단가 × 인원 표시) |
| | 예약자, 연락처, 입금자명 | 예약자 정보 요약 |

#### 하단 버튼

| 버튼 | 스타일 | 이동 경로 |
|------|--------|-----------|
| 홈으로 돌아가기 | outline (보조) | `/` |
| 예약 현황 보러가기 | primary (주요) | `/mypage` |

### 4-2. 마이페이지 (`/mypage`)

**접근 조건**: Google 로그인 필수.

#### 예약 현황 탭

| 항목 | 설명 |
|------|------|
| 예약 리스트 | 내 예약 목록을 최신순으로 표시 (카드형 UI) |
| 표시 정보 | 상태 뱃지, 수업명, 예약 일시, 신청일 |
| 상태별 표시 | 입금 대기(노란색) / 확정(초록색) / 반려(빨간색) / 취소(회색) |

#### 예약 상세 (카드 확장 또는 모달)

| 항목 | 설명 |
|------|------|
| 기본 정보 | 수업명, 예약 일시, 가격, 인원, 이름, 연락처, 입금자명, 요청사항 |
| 입금 안내 | `pending` 상태일 때 입금 계좌 정보 + 기한 표시 |
| 반려 사유 | `rejected` 상태일 때 반려 사유 표시 |
| 취소 반려 사유 | `confirmed` 상태 + 취소 반려 시 반려 사유 표시 (주황색 박스) |
| 취소 사유 | `cancelled` 상태일 때 취소 사유 표시 |

#### 예약 변경/취소 기능

| 기능 | 조건 | 동작 |
|------|------|------|
| 일정 변경 요청 | `confirmed` 상태 | 변경 희망 날짜/시간 입력 폼 표시 (관리자가 등록한 슬롯에서 선택) |
| 취소 요청 | `pending` 상태 | 즉시 취소 (관리자 승인 불요) |
| 취소 요청 | `confirmed` 상태 + 취소 요청 없음 | 취소 사유 입력 후 요청 → 관리자 승인 대기 ("취소 요청 중" 표시) |
| 취소 재요청 | `confirmed` 상태 + 취소 반려됨 | "취소 반려됨" 사유 표시 + 취소 재요청 버튼 활성화 |
| 변경 요청 상태 | 미처리 변경 요청이 있으면 "변경 요청 처리 중" 표시 |

#### 프로필 수정

| 필드 | 설명 |
|------|------|
| 이름 | 수정 가능 |
| 연락처 | 수정 가능 |
| 입금자명 | 수정 가능 |
| Google 이메일 | 표시 전용 (수정 불가) |

### 4-3. 일정 변경 요청 페이지 (`/booking/change/[token]`)

**접근 방식**: 예약 확정 알림톡(또는 마이페이지)에 포함된 고유 링크를 통해 접근 가능 (토큰 기반)

> 로그인한 사용자는 마이페이지에서 직접 변경 요청 가능하므로, 토큰 기반 접근은 알림톡을 통한 비로그인 접근 시에도 사용 가능하도록 유지.

#### 변경 요청 폼

| 입력 항목 | 타입 | 필수 | 설명 |
|----------|------|------|------|
| 현재 예약 정보 | 표시 전용 | - | 수업명, 현재 일시 표시 (수정 불가) |
| 변경 희망 날짜 | 날짜 선택(DatePicker) | ✅ | 관리자가 등록한 예약 가능 날짜만 선택 가능 |
| 변경 희망 시간 | 시간 선택(버튼 그리드) | ✅ | 선택한 날짜의 등록된 시간 슬롯에서 선택 |
| 변경 사유 | 텍스트 입력 | ❌ | 최대 200자 |

#### 제출 후 안내

- "일정 변경 요청이 접수되었습니다"
- "관리자 확인 후 결과를 안내드립니다"

#### 제약사항

- `confirmed` 상태의 예약만 변경 요청 가능
- 이미 처리되지 않은 변경 요청이 있으면 중복 신청 불가
- 토큰은 1회성이 아님 (확정 기간 동안 유효)

### 4-4. FAQ 페이지 (`/faq`)

**버튼형 아코디언 UI** — DM에서 링크로 제공 가능

- 관리자가 어드민에서 FAQ 항목 추가/수정/삭제/순서 변경 가능
- Supabase에서 활성 FAQ 목록 조회

---

## 5. 관리자(어드민) 페이지

### 5-1. 로그인 (`/admin/login`)

| 항목 | 내용 |
|------|------|
| 인증 방식 | Supabase Auth — 이메일/비밀번호 |
| 계정 수 | 1개 (운영자 본인) |
| 세션 유지 | 7일 |

### 5-2. 대시보드 (`/admin`)

| 항목 | 내용 |
|------|------|
| 통계 카드 | 오늘 확정 예약, 신규 신청(pending) 건수, 미처리 변경 요청, 이번 주 예약 |
| 이번 주 예약 캘린더 | 주간 캘린더 뷰(월~일)로 확정 예약을 시간순 표시 |
| 예약 상세 모달 | 캘린더의 예약 클릭 시 상세 모달 표시 (수업명, 예약자, 연락처, 인원, 요청사항) |
| 사이드바 | 동적 스토어명 표시 (설정에서 변경 시 즉시 반영) |

### 5-3. 예약 관리 (`/admin/reservations`)

#### 예약 리스트 테이블

| 컬럼 | 설명 |
|------|------|
| 상태 | 뱃지 (입금 대기 / 확정(입금 완료) / 반려 / 취소) |
| 수업명 | 선택한 수업 종류 |
| 예약자명 | 이름 |
| 연락처 | 전화번호 |
| 입금자명 | 계좌이체 대조용 |
| 인원 | 예약 인원수 |
| 희망 일시 | 날짜 + 시간 |
| 신청일 | 예약 신청 시각 |
| 관리자 메모 | 운영용 메모 |
| 액션 | 상태별 버튼 |

#### 상태별 액션 버튼

| 현재 상태 | 가능한 액션 | 처리 내용 |
|-----------|------------|-----------|
| `pending` | **입금 확인** | → `confirmed` + 확정 알림 발송 (알림톡 활성 시) + Google Calendar 등록 + Google Sheets 기록 |
| `pending` | **반려** | → `rejected` + 반려 안내 알림 발송 (알림톡 활성 시, 반려 사유 입력) |
| `confirmed` (취소 요청 없음) | **취소 처리** | → `cancelled` + 취소 안내 알림 발송 (알림톡 활성 시) + Calendar 이벤트 삭제 + Sheets 상태 업데이트 + 대기 중 변경 요청 자동 거절 |
| `confirmed` + 취소 요청 | **취소 승인** | → `cancelled` + 취소 안내 알림 발송 (알림톡 활성 시) + Calendar 이벤트 삭제 + Sheets 상태 업데이트 + 대기 중 변경 요청 자동 거절 |
| `confirmed` + 취소 요청 | **취소 반려** | `cancel_reason` 클리어 + `reject_reason`에 반려 사유 저장 → `confirmed` 상태 유지. 마이페이지에 "취소 반려됨" 표시 |

#### 필터/검색

- 상태별 필터 (전체 / 입금 대기 / 확정(입금 완료) / 취소 요청 / 반려 / 취소)
- 예약자명 / 연락처 검색

### 5-4. 수업 관리 (`/admin/classes`)

#### 수업 기본 정보 CRUD

| 필드 | 타입 | 필수 | 설명 |
|------|------|------|------|
| 수업명 | 텍스트 | ✅ | 예: "비즈 반지 원데이 클래스" |
| 설명 | 텍스트 | ❌ | 수업 간략 소개 (예약 폼에서 표시) |
| 소요 시간(분) | 숫자 | ✅ | 예: 60, 90, 120 |
| 가격(원) | 숫자 | ✅ | 예: 35000 |
| 최대 정원 | 숫자 | ✅ | 동시간대 최대 예약 가능 인원 |
| 활성 여부 | 토글 | ✅ | 비활성 시 예약 폼에서 미노출 |

#### 스케줄(예약 가능 일정) 관리

수업별로 예약 가능한 날짜와 시간대를 관리자가 직접 등록합니다.

| 기능 | 설명 |
|------|------|
| 스케줄 추가 | 달력에서 날짜를 선택하고, 해당 날짜의 시간 슬롯을 추가 |
| 시간 슬롯 | 시작 시간을 직접 입력 (예: 10:00, 14:00, 16:30) |
| 정원 개별 설정 | 슬롯별 정원을 수업 기본 정원과 다르게 설정 가능 (선택사항) |
| 스케줄 삭제 | 예약이 없는 슬롯만 삭제 가능 (예약이 있으면 경고 후 비활성 처리) |
| 일괄 등록 | 여러 날짜에 동일한 시간 슬롯을 한번에 등록 (편의 기능) |
| 달력 뷰 | 월간 달력에서 등록된 스케줄 확인 (날짜별 슬롯 수 표시) |

### 5-5. 변경 요청 관리 (`/admin/change-requests`)

#### 변경 요청 리스트 테이블

| 컬럼 | 설명 |
|------|------|
| 상태 | 뱃지 (대기 / 승인 / 거절) |
| 예약자명 | 원래 예약의 예약자 이름 |
| 수업명 | 수업 종류 |
| 현재 일시 | 기존 예약 날짜 + 시간 |
| 변경 희망 일시 | 요청한 새 날짜 + 시간 |
| 변경 사유 | 예약자가 입력한 사유 |
| 요청일 | 변경 요청 시각 |
| 액션 | 승인 / 거절 버튼 |

#### 액션 처리

| 액션 | 처리 내용 |
|------|-----------|
| **승인** | 예약의 날짜/시간을 변경 희망 일시로 업데이트 + Google Calendar 이벤트 수정 + Sheets 일시 업데이트 + 변경 확정 알림 발송 (알림톡 활성 시) |
| **거절** | 거절 사유 입력 + 변경 거절 알림 발송 (알림톡 활성 시, 거절 사유 포함) |

### 5-6. FAQ 관리 (`/admin/faqs`)

- FAQ 항목 추가/수정/삭제
- 드래그 앤 드롭으로 순서 변경
- 활성/비활성 토글

### 5-7. 알림 로그 (`/admin/notifications`)

- 발송된 알림 이력 확인 (카카오 알림톡 활성 시)
- 발송 상태 (성공/실패) 확인
- 재발송 기능 (카카오 → SMS fallback 순)

### 5-8. 시스템 설정 (`/admin/settings`)

#### 스토어 정보

| 설정 항목 | 설정 키 | 설명 | 반영되는 곳 |
|-----------|---------|------|------------|
| 스토어명 | `store_name` | 예: "나의 스토어" | 홈, 로그인, 브라우저 탭, 사이드바, 푸터 |
| 홈페이지 한줄소개 | `store_description` | 예: "간편하게 예약하세요" | 홈 서브타이틀, 메타태그 |
| 주소 | `workshop_address` | 예: "서울시 마포구 연남로 1길 23 2층" | 홈 "오시는 길", 알림톡 |

#### 예약 페이지

| 설정 항목 | 설정 키 | 설명 | 반영되는 곳 |
|-----------|---------|------|------------|
| 예약 버튼 문구 | `booking_button_label` | 예: "예약하기" | 홈 CTA 버튼 |
| 예약 페이지 제목 | `booking_page_title` | 예: "예약" | 예약 페이지 헤더 |
| 1단계 안내 문구 | `booking_step1_label` | 예: "원하시는 항목을 선택해 주세요." | 예약 폼 Step 1 |

#### 알림 / 캘린더

| 설정 항목 | 설정 키 | 설명 | 반영되는 곳 |
|-----------|---------|------|------------|
| 알림 발신자명 | `notification_sender_name` | 예: "나의 스토어" | 알림톡 메시지 헤더 |
| 캘린더 이벤트 접두어 | `calendar_event_prefix` | 예: "내스토어" | Google Calendar 이벤트 제목 |
| Google Calendar ID | `google_calendar_id` | 예: "abc@group.calendar.google.com" | 캘린더 이벤트 등록 대상 (env var fallback) |

#### 입금 안내

| 설정 항목 | 설정 키 | 설명 |
|-----------|---------|------|
| 입금 계좌 정보 | `bank_info` | 은행, 계좌번호, 예금주 (JSON) |
| 입금 기한 | `deposit_deadline_hours` | 신청 후 N시간 이내 (기본: 72) |

#### SNS

| 설정 항목 | 설정 키 | 설명 |
|-----------|---------|------|
| 인스타그램 핸들 | `instagram_handle` | 홈 SNS 링크 버튼 |
| 카카오톡 채널 ID | `kakao_channel_id` | 홈 SNS 링크 버튼 |

#### 카카오 알림톡 / SMS

| 설정 항목 | 설정 키 | 설명 |
|-----------|---------|------|
| 알림톡 활성화 | `kakao_enabled` | ON/OFF 토글 — OFF 시 알림톡 미발송 |
| 알리고 API Key | `aligo_api_key` | 알림톡 활성 시 필수 |
| 알리고 User ID | `aligo_user_id` | 알림톡 활성 시 필수 |
| 발신 프로필 키 | `aligo_sender_key` | 알림톡 활성 시 필수 |
| SMS 발신번호 | `sms_sender_number` | 알림톡 활성 시 필수 |

---

## 6. 자동 알림 시스템

> **카카오 알림톡은 선택(옵션) 기능**입니다. 관리자 설정에서 알림톡을 활성화하지 않으면, 예약 상태 변경은 정상적으로 처리되지만 알림톡은 발송되지 않습니다. 예약자는 마이페이지에서 예약 상태를 직접 확인할 수 있습니다.

### 6-1. 알림 발송 조건

| 트리거 | 수신자 | 메시지 유형 | 발송 채널 |
|--------|--------|------------|-----------|
| 입금 확인(확정) | 예약자 | 확정 안내 | 카카오 알림톡 (활성 시) + 마이페이지 상태 반영 |
| 관리자 반려 | 예약자 | 반려 + 문의 안내 | 카카오 알림톡 (활성 시) + 마이페이지 상태 반영 |
| 취소 처리 | 예약자 | 취소 완료 안내 | 카카오 알림톡 (활성 시) + 마이페이지 상태 반영 |
| 변경 승인 | 예약자 | 변경 확정 안내 | 카카오 알림톡 (활성 시) + 마이페이지 상태 반영 |
| 변경 거절 | 예약자 | 변경 거절 안내 | 카카오 알림톡 (활성 시) + 마이페이지 상태 반영 |

### 6-2. 알림톡 미사용 시 동작

- 예약 상태 변경은 정상 처리 (DB 업데이트, Calendar/Sheets 연동)
- 알림톡 미발송, notifications 테이블에 기록하지 않음
- 예약자는 마이페이지에서 실시간 상태 확인
- 관리자가 필요 시 직접 연락 (DM, 전화 등)

### 6-3. 메시지 템플릿 (알림톡 활성 시)

> 템플릿의 `{스토어명}`은 관리자 설정의 `notification_sender_name` 값으로 동적 치환됩니다.

#### 확정(입금 완료) 안내
```
[{스토어명}] 예약 확정 안내

{이름}님, 입금이 확인되어 예약이 확정되었습니다.

■ 수업: {수업명}
■ 일시: {날짜} {시간}
■ 금액: {금액}

일정 변경이 필요하신 경우 아래 링크를 이용해 주세요.
▶ {변경 링크}

감사합니다. {스토어명}에서 뵙겠습니다!
```

#### 반려
```
[{스토어명}] 예약 반려 안내

{이름}님, 죄송합니다.
요청하신 예약이 반려되었습니다.

■ 수업: {수업명}
■ 일시: {날짜} {시간}
■ 사유: {반려 사유}

다른 일정으로 다시 예약해 주시면 감사하겠습니다.
```

#### 변경 승인
```
[{스토어명}] 일정 변경 승인 안내

{이름}님, 일정 변경이 승인되었습니다.

■ 수업: {수업명}
■ 변경 전: {기존 날짜} {기존 시간}
■ 변경 후: {새 날짜} {새 시간}

변경된 일정으로 뵙겠습니다!
```

#### 변경 거절
```
[{스토어명}] 일정 변경 거절 안내

{이름}님, 죄송합니다.
요청하신 일정 변경이 승인되지 않았습니다.

■ 수업: {수업명}
■ 현재 일정: {날짜} {시간}
■ 사유: {거절 사유}

기존 일정 그대로 진행됩니다.
```

#### 취소
```
[{스토어명}] 예약 취소 안내

{이름}님, 예약이 취소되었습니다.

■ 수업: {수업명}
■ 일시: {날짜} {시간}

문의사항은 카카오톡 채널로 연락 부탁드립니다.
```

---

## 7. 외부 연동

### 7-1. Google OAuth 연동 (사용자 인증)

| 항목 | 내용 |
|------|------|
| 서비스 | Supabase Auth의 Google OAuth Provider |
| 설정 | Google Cloud Console에서 OAuth 클라이언트 ID/Secret 발급 |
| Redirect URI | Supabase Auth callback URL |
| 스코프 | `email`, `profile` (기본) |

### 7-2. Google Calendar 연동

| 항목 | 내용 |
|------|------|
| 트리거 | `confirmed` 상태 변경 시 |
| 인증 | Google Service Account |
| Calendar ID | 관리자 설정(`google_calendar_id`) 우선, 없으면 `GOOGLE_CALENDAR_ID` 환경변수 fallback |
| 이벤트 제목 | `[{캘린더 접두어}] {수업명} - {예약자명}({인원}명)` (접두어는 `calendar_event_prefix` 설정값) |
| 이벤트 시간 | 시작: 희망 일시, 종료: 시작 + 수업 소요 시간 |
| 이벤트 설명 | 예약자명, 연락처, 인원, 요청사항 |
| 수정 | 변경 요청 승인 시 이벤트 일시 업데이트 |
| 삭제 | `cancelled` 시 해당 이벤트 삭제 |

### 7-3. Google Sheets 연동

| 항목 | 내용 |
|------|------|
| 트리거 | `confirmed` 상태 변경 시 행 추가, `cancelled` 시 상태 업데이트 |
| 인증 | Google Service Account |
| 시트 이름 | `예약목록` (정확히 일치 필요) |

#### 기록 컬럼 (A~J, 10열)

| A | B | C | D | E | F | G | H | I | J |
|---|---|---|---|---|---|---|---|---|---|
| 신청일 | 확정일 | 수업명 | 예약자명 | 연락처 | 인원 | 일시 | 금액 | 상태 | 메모 |

> 금액은 `가격 × 인원` 총액 표시, 인원은 `{N}명` 형식.

### 7-4. 카카오 알림톡 발송 (옵션)

| 항목 | 내용 |
|------|------|
| 활성화 조건 | 관리자 설정에서 `kakao_enabled` ON + 알리고 API 설정 완료 시 |
| 서비스 | 카카오 비즈메시지 (알리고 대행사 경유) |
| 사전 준비 | 카카오톡 채널 개설 + 알림톡 템플릿 검수 승인 필요 |
| 발송 시점 | 상태 변경 시 자동 (활성화된 경우만) |
| 대체 발송(fallback) | 알림톡 발송 실패 시 SMS로 대체 발송 |
| 비활성 시 | 알림톡 미발송, 관리자가 직접 안내 (DM/전화) |

---

## 8. 실시간 데이터 동기화

Supabase Realtime broadcast 채널을 활용한 실시간 데이터 동기화.

| 항목 | 내용 |
|------|------|
| 채널 | 단일 공유 broadcast 채널 (`db-changes`) |
| 동작 방식 | 데이터 변경 시 `notifyChange(table)` → 같은 테이블을 구독 중인 컴포넌트 자동 refetch |
| 디바운싱 | 300ms 디바운스로 과도한 refetch 방지 |
| 활용 예 | 예약 폼에서 잔여석 실시간 업데이트, 관리자 페이지에서 새 예약 자동 반영 |

---

## 9. 비기능 요구사항

| 항목 | 내용 |
|------|------|
| 반응형 | 모바일 우선 (예약 페이지는 대부분 모바일 접속) |
| 접근성 | 폰트 최소 14px, 버튼 최소 44px 터치 영역 |
| 성능 | 예약 폼 로딩 2초 이내 |
| 보안 | Google OAuth 인증, 어드민 이메일/비밀번호 인증, RLS 기반 행 수준 보안, Service Role Key 서버 전용 |
| SEO | 동적 메타태그 (스토어명, 소개문) |
| 배포 | Vercel |

---

## 10. 페이지 맵

```
/ 홈 (랜딩 — CTA 버튼, 주소, SNS 링크)
├── /login                         Google 로그인
├── /booking                       예약 신청 폼 (4단계, 로그인 필수)
├── /booking/complete              예약 신청 완료 (입금 안내 + 예약 확인)
├── /mypage                        마이페이지 (로그인 필수)
│   ├── 예약 현황                   내 예약 목록 + 상세
│   ├── 변경/취소 요청               예약 변경·취소 요청
│   └── 프로필 수정                  이름/연락처/입금자명 수정
├── /booking/change/[token]        일정 변경 요청 (토큰 기반 — 알림톡 경유)
├── /faq                           자주 묻는 질문
│
└── /admin
    ├── /admin/login               관리자 로그인
    ├── /admin                     대시보드 (통계 + 주간 캘린더)
    ├── /admin/reservations        예약 관리
    ├── /admin/change-requests     변경 요청 관리
    ├── /admin/classes             수업 관리 (기본 정보 + 스케줄 등록)
    ├── /admin/faqs                FAQ 관리
    ├── /admin/notifications       알림 로그 (알림톡 활성 시)
    └── /admin/settings            시스템 설정 (브랜딩, 입금 계좌, 알림톡 ON/OFF 등)
```

---

## 11. 향후 확장 고려사항 (MVP 이후)

- 수업 후기/포토 갤러리
- 반복 예약 (정기 수업)
- 통계 대시보드 (월별 매출, 수업별 인기도)
- 요일+시간 패턴 기반 스케줄 자동 생성 (반복 일정 등록 편의 기능)
- 카카오 로그인 추가 지원
